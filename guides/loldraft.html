<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>LoL 밴픽 시뮬레이터</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617, #020617);
      color: #e5e7eb;
    }
    .page {
      max-width: 1200px;
      margin: 24px auto;
      padding: 16px 20px 24px;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 8px;
    }
    .back-link {
      text-decoration: none;
      color: #e5e7eb;
      font-size: 0.9rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .back-link:hover {
      background: rgba(30, 64, 175, 0.8);
    }
    .title {
      font-size: 1.2rem;
      font-weight: 700;
    }
    .sub {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-bottom: 12px;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="top-bar">
      <a href="../index.html" class="back-link">
        ← 메인으로
      </a>
      <div class="title">LoL 밴픽 시뮬레이터</div>
    </div>
    <p class="sub">
      OGN 스타일 Fearless Draft 시뮬레이터입니다. Bo1/Bo3/Bo5, 전 세트 챔피언 중복 금지, 교환 단계까지 구현되어 있습니다.
    </p>

    <!-- React 앱이 렌더링될 자리 -->
    <div id="root"></div>
  </div>

  <!-- React / ReactDOM / Babel CDN 불러오기 -->
  <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <!-- 네가 준 코드를 브라우저에서 바로 돌 수 있게 변환 -->
  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;

    // =============================================================
    // Fearless Draft – Clean Build (stable)
    // =============================================================

    const TURN_SEC = 30;
    const TRADE_SEC = 60;

    // Tournament draft order
    const STEPS = [
      // Ban Phase 1 (3 each)
      { phase: "BAN1", side: "BLUE", action: "BAN" },
      { phase: "BAN1", side: "RED", action: "BAN" },
      { phase: "BAN1", side: "BLUE", action: "BAN" },
      { phase: "BAN1", side: "RED", action: "BAN" },
      { phase: "BAN1", side: "BLUE", action: "BAN" },
      { phase: "BAN1", side: "RED", action: "BAN" },
      // Pick Phase 1 (1–2–2–1)
      { phase: "PICK1", side: "BLUE", action: "PICK" },
      { phase: "PICK1", side: "RED", action: "PICK" },
      { phase: "PICK1", side: "RED", action: "PICK" },
      { phase: "PICK1", side: "BLUE", action: "PICK" },
      { phase: "PICK1", side: "BLUE", action: "PICK" },
      { phase: "PICK1", side: "RED", action: "PICK" },
      // Ban Phase 2 (2 each)
      { phase: "BAN2", side: "RED", action: "BAN" },
      { phase: "BAN2", side: "BLUE", action: "BAN" },
      { phase: "BAN2", side: "RED", action: "BAN" },
      { phase: "BAN2", side: "BLUE", action: "BAN" },
      // Pick Phase 2 (1–2–1)
      { phase: "PICK2", side: "RED", action: "PICK" },
      { phase: "PICK2", side: "BLUE", action: "PICK" },
      { phase: "PICK2", side: "BLUE", action: "PICK" },
      { phase: "PICK2", side: "RED", action: "PICK" },
    ];

    function DraftApp(){
      // Start gate
      const [seriesType, setSeriesType] = useState(null); // "BO1" | "BO3" | "BO5"
      const [blueName, setBlueName] = useState("");
      const [redName, setRedName] = useState("");
      const [started, setStarted] = useState(false);

      // Series / Set state
      const maxGames = seriesType === "BO5" ? 5 : (seriesType === "BO3" ? 3 : 1);
      const [gameNumber, setGameNumber] = useState(1);

      // Per-set draft
      const [stepIndex, setStepIndex] = useState(0);
      const [blueBans, setBlueBans] = useState([]); // (string|null)[]
      const [redBans, setRedBans] = useState([]);
      const [bluePicks, setBluePicks] = useState([null, null, null, null, null]);
      const [redPicks, setRedPicks] = useState([null, null, null, null, null]);
      const [history, setHistory] = useState([]);

      // Single preview / pending selection
      const [pendingId, setPendingId] = useState(null);

      // Timers
      const [timeLeft, setTimeLeft] = useState(TURN_SEC);
      const lastAutoAt = useRef(-1);
      const autoLock = useRef(false);

      // Data Dragon
      const [version, setVersion] = useState(null);
      const [champs, setChamps] = useState([]); // {id,name,icon}
      const [query, setQuery] = useState("");

      // Global Fearless memory (by set snapshots)
      const [sets, setSets] = useState([]); // { setNo, blueTeam, redTeam, blue:[], red:[] }
      const setTeamsRef = useRef({ blue: "", red: "" }); // snapshot team names when draft finishes

      // Trade phase
      const [tradeMode, setTradeMode] = useState(false);
      const [tradeTimeLeft, setTradeTimeLeft] = useState(TRADE_SEC);
      const [selBlue, setSelBlue] = useState(null);
      const [selRed, setSelRed] = useState(null);
      const [blueConfirm, setBlueConfirm] = useState(false);
      const [redConfirm, setRedConfirm] = useState(false);
      const [askedSwapDone, setAskedSwapDone] = useState(false);
      const [swappedThisRound, setSwappedThisRound] = useState(false);
      const [showResetMenu, setShowResetMenu] = useState(false);
      // Guards
      const committedRef = useRef(false);
      const isFinalSet = (seriesType === "BO1") || (gameNumber === maxGames);

      // Derived
      const currentStep = stepIndex < STEPS.length ? STEPS[stepIndex] : null;
      const finished = stepIndex >= STEPS.length;
      const previewBlueSlot = (currentStep && currentStep.action === "PICK" && currentStep.side === "BLUE") ? nextEmptyPickSlot("BLUE") : null;
      const previewRedSlot  = (currentStep && currentStep.action === "PICK" && currentStep.side === "RED")  ? nextEmptyPickSlot("RED")  : null;

      const usedNow = useMemo(()=> new Set([
        ...blueBans.filter(Boolean),
        ...redBans.filter(Boolean),
        ...bluePicks.filter(Boolean),
        ...redPicks.filter(Boolean),
      ]), [blueBans, redBans, bluePicks, redPicks]);

      const carryALL = useMemo(()=>{
        const all = new Set();
        for (const s of sets){
          for (const id of s.blue) all.add(id);
          for (const id of s.red) all.add(id);
        }
        return all;
      }, [sets]);

      // Load champions
      useEffect(()=>{
        (async()=>{
          try{
            const vers = await fetch("https://ddragon.leagueoflegends.com/api/versions.json").then(r=>r.json());
            const v = vers[0];
            setVersion(v);
            const c = await fetch(`https://ddragon.leagueoflegends.com/cdn/${v}/data/ko_KR/champion.json`).then(r=>r.json());
            const arr = Object.values(c.data).map(d=>({ id:d.id, name:d.name, icon:`https://ddragon.leagueoflegends.com/cdn/${v}/img/champion/${d.image.full}` }));
            arr.sort((a,b)=> a.name.localeCompare(b.name));
            setChamps(arr);
          }catch(e){
            // fallback minimal
            const v = "14.10.1";
            setVersion(v);
            setChamps([
              { id:"Aatrox", name:"아트록스", icon:`https://ddragon.leagueoflegends.com/cdn/${v}/img/champion/Aatrox.png` },
              { id:"Ahri", name:"아리", icon:`https://ddragon.leagueoflegends.com/cdn/${v}/img/champion/Ahri.png` },
              { id:"LeeSin", name:"리 신", icon:`https://ddragon.leagueoflegends.com/cdn/${v}/img/champion/LeeSin.png` },
              { id:"Jhin", name:"진", icon:`https://ddragon.leagueoflegends.com/cdn/${v}/img/champion/Jhin.png` },
              { id:"Rakan", name:"라칸", icon:`https://ddragon.leagueoflegends.com/cdn/${v}/img/champion/Rakan.png` },
            ]);
          }
        })();
      }, []);

      // Helpers
      function canUse(id, side){
        if (usedNow.has(id)) return false;
        if (gameNumber > 1 && carryALL.has(id)) return false; // Global fearless from set 2+
        return true;
      }
      function availFor(side){
        return champs.map(c=>c.id).filter(id=>canUse(id, side));
      }
      function nextEmptyPickSlot(side){
        const arr = side === "BLUE" ? bluePicks : redPicks;
        for (let i=0;i<arr.length;i++){ if (arr[i]==null) return i; }
        return null;
      }

      function clearPreviewState(){ setPendingId(null); }

      function applyAction(id){
        if (finished || !currentStep) return;
        const { side, action } = currentStep;
        if (!canUse(id, side)) return;
        if (action === "BAN"){
          if (side === "BLUE") setBlueBans(a=>[...a, id]); else setRedBans(a=>[...a, id]);
        } else {
          const slot = nextEmptyPickSlot(side); if (slot==null) return;
          if (side === "BLUE") setBluePicks(a=>a.map((v,i)=> i===slot ? id : v));
          else setRedPicks(a=>a.map((v,i)=> i===slot ? id : v));
        }
        setHistory(h=>[...h, {side, action, id}]);
        setStepIndex(i=> i+1);
        clearPreviewState();
        setTimeLeft(TURN_SEC);
      }

      function undo(){
        if (history.length===0) return;
        const prev = history[history.length-1];
        setHistory(h=>h.slice(0,-1));
        setStepIndex(i=> Math.max(0, i-1));
        if (prev.action === "BAN"){
          if (prev.side === "BLUE") setBlueBans(a=> a.slice(0,-1)); else setRedBans(a=> a.slice(0,-1));
        } else {
          if (prev.side === "BLUE"){
            const arr = [...bluePicks];
            for (let i=arr.length-1;i>=0;i--){ if (arr[i]!=null){ arr[i]=null; break; } }
            setBluePicks(arr);
          } else {
            const arr = [...redPicks];
            for (let i=arr.length-1;i>=0;i--){ if (arr[i]!=null){ arr[i]=null; break; } }
            setRedPicks(arr);
          }
        }
        clearPreviewState();
        setTimeLeft(TURN_SEC);
      }

      function resetGame(){
        setStepIndex(0);
        setHistory([]);
        setBlueBans([]);
        setRedBans([]);
        setBluePicks([null,null,null,null,null]);
        setRedPicks([null,null,null,null,null]);
        clearPreviewState();
        setTradeMode(false);
        setTradeTimeLeft(TRADE_SEC);
        setSelBlue(null); setSelRed(null);
        setBlueConfirm(false); setRedConfirm(false);
        setAskedSwapDone(false); setSwappedThisRound(false);
        setTimeLeft(TURN_SEC);
        lastAutoAt.current = -1; autoLock.current = false; committedRef.current = false;
      }
      function resetSet(){
        // If the last committed set equals the current game number, remove it
        setSets(s=>{
          if (s.length===0) return s;
          const last = s[s.length-1];
          if (last && last.setNo === gameNumber) return s.slice(0,-1);
          return s;
        });
        resetGame();
      }
      function resetMatch(){
        // Full match reset: return to start overlay and clear all state
        setSets([]);
        setGameNumber(1);
        setSeriesType(null);
        setBlueName("");
        setRedName("");
        setStarted(false);
        setTeamsRef.current = { blue: "", red: "" };
        resetGame();
      }

      // Step timer
      useEffect(()=>{
        if (!started || finished) return;
        const t = setInterval(()=> setTimeLeft(v=> v>0 ? v-1 : 0), 1000);
        return ()=> clearInterval(t);
      }, [started, finished]);

      // Timeout handler (single-fire guarded)
      useEffect(()=>{
        if (!started || finished || !currentStep) return;
        if (timeLeft===0 && lastAutoAt.current!==stepIndex && !autoLock.current){
          autoLock.current = true; // lock immediately
          lastAutoAt.current = stepIndex;

          const { side, action } = currentStep;
          if (action === "BAN"){
            // push null to indicate SKIP (for overlay)
            if (side === "BLUE") setBlueBans(a=>[...a, null]); else setRedBans(a=>[...a, null]);
            setHistory(h=>[...h, { side, action:"BAN", id:"SKIP" }]);
            setStepIndex(i=> i+1);
            setTimeLeft(TURN_SEC);
            clearPreviewState();
          } else {
            const avail = availFor(side);
            const previewCommit = pendingId && canUse(pendingId, side) ? pendingId : null;
            if (previewCommit){
              applyAction(previewCommit);
            } else if (avail.length>0){
              const id = avail[Math.floor(Math.random()*avail.length)];
              applyAction(id);
            } else {
              const slot = nextEmptyPickSlot(side);
              if (slot!=null){
                if (side === "BLUE") setBluePicks(a=>a.map((v,i)=> i===slot ? null : v));
                else setRedPicks(a=>a.map((v,i)=> i===slot ? null : v));
                setHistory(h=>[...h, { side, action:"PICK", id:"SKIP" }]);
                setStepIndex(i=> i+1);
                setTimeLeft(TURN_SEC);
                clearPreviewState();
              }
            }
          }
        }
      }, [timeLeft, stepIndex, started, finished, currentStep, champs, pendingId]);

      // Release lock when timer above zero (new turn)
      useEffect(()=>{ if (timeLeft>0) autoLock.current = false; }, [timeLeft]);

      // Enter trade phase once finished
      useEffect(()=>{
        if (finished){
          setTradeMode(true);
          setTradeTimeLeft(TRADE_SEC);
          setBlueConfirm(false); setRedConfirm(false);
          setSelBlue(null); setSelRed(null);
          setAskedSwapDone(false); setSwappedThisRound(false);
          setTeamsRef.current = { blue: blueName, red: redName };
          committedRef.current = false;
        } else {
          setTradeMode(false);
        }
      }, [finished, blueName, redName]);

      // Trade timer
      useEffect(()=>{
        if (!tradeMode) return;
        const t = setInterval(()=> setTradeTimeLeft(v=> v>0 ? v-1 : 0), 1000);
        return ()=> clearInterval(t);
      }, [tradeMode]);

      // Auto confirm on trade timeout
      useEffect(()=>{
        if (tradeMode && tradeTimeLeft===0){ setBlueConfirm(true); setRedConfirm(true); }
      }, [tradeMode, tradeTimeLeft]);

      // Auto-commit when final set (BO1 or last) is double-confirmed
      useEffect(()=>{
        if (tradeMode && blueConfirm && redConfirm && isFinalSet && !committedRef.current){
          commitCurrentSet();
          setAskedSwapDone(true); // skip swap stage on final set
        }
      }, [tradeMode, blueConfirm, redConfirm, isFinalSet]);

      // Auto-advance to next set when user chose to swap (예) and both teams confirmed
      useEffect(()=>{
        if (tradeMode && !isFinalSet && blueConfirm && redConfirm && askedSwapDone && swappedThisRound){
          proceedAfterTrade();
        }
      }, [tradeMode, isFinalSet, blueConfirm, redConfirm, askedSwapDone, swappedThisRound]);

      // Trade interactions: click two slots within same team to swap
      function handlePickSlotClick(side, idx){
        if (!tradeMode) return;
        if (side === 'BLUE' && !blueConfirm){
          if (selBlue===null) setSelBlue(idx);
          else if (selBlue===idx) setSelBlue(null);
          else { setBluePicks(arr=>{ const a=[...arr]; const t=a[selBlue]; a[selBlue]=a[idx]; a[idx]=t; return a; }); setSelBlue(null); }
        }
        if (side === 'RED' && !redConfirm){
          if (selRed===null) setSelRed(idx);
          else if (selRed===idx) setSelRed(null);
          else { setRedPicks(arr=>{ const a=[...arr]; const t=a[selRed]; a[selRed]=a[idx]; a[idx]=t; return a; }); setSelRed(null); }
        }
      }

      function swapSidesNow(){
        const bn = blueName, rn = redName;
        setBlueName(rn); setRedName(bn);
        setAskedSwapDone(true); setSwappedThisRound(true);
      }

      function commitCurrentSet(){
        if (committedRef.current) return;
        committedRef.current = true;
        setSets(s=>[...s, {
          setNo: gameNumber,
          blueTeam: setTeamsRef.current.blue,
          redTeam: setTeamsRef.current.red,
          blue: bluePicks.filter(Boolean),
          red: redPicks.filter(Boolean)
        }]);
      }

      function proceedAfterTrade(){
        if (!(blueConfirm && redConfirm && askedSwapDone)) return;
        commitCurrentSet();
        if (gameNumber < maxGames){
          setGameNumber(g=> g+1);
          resetGame();
        } else {
          setTradeMode(false);
        }
      }

      function unavailableForTeam(team){
        const ids = new Set();
        for (const s of sets){
          if (s.blueTeam === team){ (s.blue||[]).forEach(id=>ids.add(id)); }
          else if (s.redTeam === team){ (s.red||[]).forEach(id=>ids.add(id)); }
        }
        return Array.from(ids);
      }

      // Dev sanity checks (no-op in prod)
      function runDevChecks(){
        try{
          console.assert(Array.isArray(STEPS) && STEPS.length===20, 'STEPS length should be 20');
          console.assert(bluePicks.length===5 && redPicks.length===5, 'Pick slots must be 5');
        }catch(_e){}
      }
      useEffect(()=>{ runDevChecks(); }, []);

      const filtered = useMemo(()=>{
        const q = query.trim().toLowerCase();
        if (!q) return champs;
        return champs.filter(c=> c.name.toLowerCase().includes(q) || c.id.toLowerCase().includes(q));
      }, [query, champs]);

      return (
        <div style={styles.app}>
          <style>{css}</style>
          <div style={styles.container}>
            <Header
              version={version}
              blueName={blueName||"BLUE"}
              redName={redName||"RED"}
              gameNumber={gameNumber}
              maxGames={maxGames}
              onToggleResetMenu={()=>setShowResetMenu(v=>!v)}
              showResetMenu={showResetMenu}
              onResetSet={()=>{ resetSet(); setShowResetMenu(false); }}
              onResetMatch={()=>{ resetMatch(); setShowResetMenu(false); }}
            />

            {!started && (
              <SetupOverlay
                seriesType={seriesType}
                setSeriesType={setSeriesType}
                blueName={blueName}
                redName={redName}
                setBlueName={setBlueName}
                setRedName={setRedName}
                onStart={()=>{ if(seriesType && blueName.trim() && redName.trim()) setStarted(true); }}
              />
            )}

            <div className="layout">
              <div className="leftcol">
                <TeamPanel
                  side="BLUE"
                  teamName={blueName||"BLUE"}
                  bans={blueBans}
                  picks={bluePicks}
                  tradeMode={tradeMode}
                  onPickSlotClick={handlePickSlotClick}
                  selectedIndex={selBlue}
                  confirmed={blueConfirm}
                  previewId={(currentStep && currentStep.action==='PICK' && currentStep.side==='BLUE') ? pendingId : null}
                  previewSlotIndex={previewBlueSlot}
                  unavailable={unavailableForTeam(blueName||'BLUE')}
                  version={version}
                />
              </div>

              <div className="center">
                <DraftBar currentStep={currentStep} finished={finished} timeLeft={timeLeft} gameNumber={gameNumber} />

                <div className="toolbar">
                  <input className="search" placeholder="챔피언 검색 (한글/영문)" value={query} onChange={e=>setQuery(e.target.value)} />
                </div>

                <div className="gridWrap">
                  <div className="grid">
                    {filtered.map(c=>{
                      const disabled = !(currentStep && canUse(c.id, currentStep.side)) || finished;
                      const selected = pendingId === c.id;
                      return (
                        <button key={c.id} className={"champ "+(disabled?"disabled":"")+(selected?" selected":"")} title={c.name} onClick={()=>{ if(!disabled) setPendingId(c.id); }}>
                          <img alt={c.name} src={c.icon} />
                        </button>
                      );
                    })}
                  </div>
                </div>
                <button className="btn confirm" disabled={!pendingId || finished} onClick={()=>{ if(pendingId) applyAction(pendingId); }}>확인</button>

                {tradeMode && (
                  <div className="trade">
                    <div className="tr-head">교환 단계 <span className="badge">{tradeTimeLeft}</span></div>
                    <div className="tr-sub">같은 팀 내에서 픽 슬롯 두 곳을 차례로 클릭하면 교환됩니다.</div>
                    <div className="tr-actions">
                      <button className={"btn "+(blueConfirm?"ok":"")} disabled={blueConfirm} onClick={()=>setBlueConfirm(true)}>{blueName||'BLUE'} 확정</button>
                      <button className={"btn "+(redConfirm?"ok":"")} disabled={redConfirm} onClick={()=>setRedConfirm(true)}>{redName||'RED'} 확정</button>

                      {!isFinalSet && blueConfirm && redConfirm && !askedSwapDone && (
                        <div className="swap">
                          <span>진영을 바꾸시겠습니까?</span>
                          <button className="btn" onClick={swapSidesNow} disabled={swappedThisRound}>예</button>
                          <button className="btn" onClick={()=>setAskedSwapDone(true)} disabled={swappedThisRound}>아니오</button>
                        </div>
                      )}

                      {!isFinalSet && blueConfirm && redConfirm && askedSwapDone && (
                        <button className="btn start" onClick={proceedAfterTrade}>다음 세트 시작</button>
                      )}

                      {isFinalSet && blueConfirm && redConfirm && (
                        <div className="finalize">
                          <span>드래프트 종료</span>
                          <button className="btn danger" onClick={resetSet}>세트 초기화</button>
                          <button className="btn danger" onClick={resetMatch}>매치 초기화</button>
                        </div>
                      )}
                    </div>
                  </div>
                )}
              </div>

              <div className="rightcol">
                <TeamPanel
                  side="RED"
                  teamName={redName||"RED"}
                  bans={redBans}
                  picks={redPicks}
                  tradeMode={tradeMode}
                  onPickSlotClick={handlePickSlotClick}
                  selectedIndex={selRed}
                  confirmed={redConfirm}
                  previewId={(currentStep && currentStep.action==='PICK' && currentStep.side==='RED') ? pendingId : null}
                  previewSlotIndex={previewRedSlot}
                  unavailable={unavailableForTeam(redName||'RED')}
                  version={version}
                />
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ---------------- Components ----------------
    function Header({version, blueName, redName, gameNumber, maxGames, onToggleResetMenu, showResetMenu, onResetSet, onResetMatch}){
      return (
        <div className="header">
          {/* Top-left brand intentionally blank */}
          <div className="brand-placeholder" />
          <div className="right">
            <div className="game">Game {gameNumber} / {maxGames}</div>
            <div className="score"><span className="blue">{blueName}</span> vs <span className="red">{redName}</span></div>
            <button className="btn" onClick={onToggleResetMenu}>초기화</button>
            {showResetMenu && (
              <div className="resetmenu">
                <button className="btn danger" onClick={onResetSet}>세트 초기화</button>
                <button className="btn danger" onClick={onResetMatch}>매치 초기화</button>
              </div>
            )}
          </div>
        </div>
      );
    }


    function SetupOverlay({seriesType, setSeriesType, blueName, redName, setBlueName, setRedName, onStart}){
      const ready = !!(seriesType && blueName.trim() && redName.trim());
      return (
        <div className="overlay">
          <div className="dialog">
            <h2>시작 설정</h2>
            <div className="row decal">
              <button className={"btn mode bo1 "+(seriesType==="BO1"?"active":"")}  onClick={()=>setSeriesType("BO1")}>Bo1</button>
              <button className={"btn mode bo3 "+(seriesType==="BO3"?"active":"")}  onClick={()=>setSeriesType("BO3")}>Bo3</button>
              <button className={"btn mode bo5 "+(seriesType==="BO5"?"active":"")}  onClick={()=>setSeriesType("BO5")}>Bo5</button>
            </div>
            <div className="row">
              <input className="in" placeholder="블루 팀명" value={blueName} onChange={e=>setBlueName(e.target.value)} />
              <input className="in" placeholder="레드 팀명" value={redName} onChange={e=>setRedName(e.target.value)} />
            </div>
            <div className="row small">Fearless Draft - 해당하는 경기/매치 동안 양 팀이 선택한 챔피언을 다시 선택할 수 없습니다.</div>
            <div className="row center">
              <button className="btn start" disabled={!ready} onClick={onStart}>드래프트 시작</button>
            </div>
          </div>
        </div>
      );
    }

    function TeamPanel({side, teamName, bans, picks, tradeMode, onPickSlotClick, selectedIndex, confirmed, previewId, previewSlotIndex, version, unavailable}){
      const ROLES = ["TOP","JGL","MID","BOT","SUP"];
      const order = side === 'BLUE' ? [0,1,2,3,4] : [4,3,2,1,0];
      const splitStartPos = side === 'BLUE' ? 3 : 2; // BLUE: 123 | 45  / RED: 54 | 321
      return (
        <div className={"side "+(side==='BLUE'?"side-blue":"side-red") }>
          <div className="head">
            <div className="name">{teamName}</div>
            <div className="tag">{side}</div>
          </div>

          {/* PICKS first */}
          <div className="picks">
            <div className="pickcol">
              {picks.map((id, i)=> (
                <div
                  key={i}
                  className={"pick "+(tradeMode && !confirmed ? "clickable":"")+(selectedIndex===i?" selected":"")+(!picks[i] && previewId && i===previewSlotIndex ? " preview":"")}
                  onClick={()=> onPickSlotClick && onPickSlotClick(side, i)}
                >
                  {id ? <Icon id={id} version={version} /> : (previewId && i===previewSlotIndex ? <img alt="preview" src={`https://ddragon.leagueoflegends.com/cdn/${version||'14.10.1'}/img/champion/${previewId}.png`} style={{width:"100%",height:"100%",objectFit:"cover",opacity:.9}}/> : null)}
                  <div className="role-tag">{ROLES[i]}</div>
                </div>
              ))}
            </div>
          </div>

          {/* BANS moved to bottom, mirrored order and split gap */}
          <div className="bans bans-bottom">
            <div className="label">BANS</div>
            <div className="banrow">
              {order.map((idx, pos)=> {
                const val = bans[idx];
                const isTimeout = idx < bans.length && val == null;
                return (
                  <div key={idx} className={"ban "+(pos===splitStartPos?"split-start":"")}>
                    {val ? <BanIcon id={val} version={version} /> : (isTimeout ? <BanEmpty /> : null)}
                  </div>
                );
              })}
            </div>
          </div>

          {unavailable && unavailable.length>0 && (
            <div className="unavail">
              <div className="label">사용 불가</div>
              <div className="unfaces">
                {unavailable.map(id=> (
                  <img key={id} alt="" src={`https://ddragon.leagueoflegends.com/cdn/${version||'14.10.1'}/img/champion/${id}.png`} />
                ))}
              </div>
            </div>
          )}
        </div>
      );
    }


    function BanIcon({id, version}){
      const v = version || '14.10.1';
      return (
        <div className="banimg">
          <img alt={id} src={`https://ddragon.leagueoflegends.com/cdn/${v}/img/champion/${id}.png`} />
          <span className="ban-mark" aria-hidden="true"></span>
        </div>
      );
    }

    function BanEmpty(){
      return (
        <div className="banimg">
          <span className="ban-mark" aria-hidden="true"></span>
        </div>
      );
    }

    function Icon({id, version}){
      const v = version || '14.10.1';
      return <img alt={id} src={`https://ddragon.leagueoflegends.com/cdn/${v}/img/champion/{id}.png`} style={{width:"100%", height:"100%", objectFit:"cover"}}/>;
    }

    function DraftBar({currentStep, finished, timeLeft, gameNumber}){
      const activeSide = currentStep && currentStep.side;
      const isBlueTurn = !finished && activeSide === "BLUE";
      const isRedTurn = !finished && activeSide === "RED";
      return (
        <div className="topbar">
          <div className={"sideblock left "+(isBlueTurn?"on":"off")}>{isBlueTurn ? <span className="count">{timeLeft}</span> : null}</div>
          <div className="gamecenter">GAME {gameNumber}</div>
          <div className={"sideblock right "+(isRedTurn?"on":"off")}>{isRedTurn ? <span className="count">{timeLeft}</span> : null}</div>
        </div>
      );
    }

    // ---------------- Styles ----------------
    const styles = {
      app: { minHeight:"100vh", background:"#0f172a", color:"#e2e8f0" },
      container: { maxWidth:1200, margin:"0 auto", padding:"24px" },
    };

    const css = `
.header{display:flex;justify-content:space-between;gap:12px;align-items:center;margin-bottom:8px}
.brand{font-weight:700;font-size:20px}
.ver{color:#94a3b8;font-size:12px;margin-left:8px}
.right{display:flex;gap:8px;align-items:center;position:relative}
.score{background:#0b1220;border:1px solid #1f2937;border-radius:12px;padding:6px 10px;font-size:14px}
.score .blue{color:#7dd3fc;font-weight:600}
.score .red{color:#fda4af;font-weight:600}
.game{background:#0b1220;border:1px solid #1f2937;border-radius:12px;padding:6px 10px;font-size:14px}
.btn{background:#0b1220;border:1px solid #334155;border-radius:10px;padding:6px 10px;color:#e2e8f0;cursor:pointer}
.btn:disabled{opacity:.5;cursor:not-allowed}
.btn.start{background:#4f46e5;border-color:#312e81}
.btn.ok{opacity:.65;pointer-events:none}
.btn.mode{height:56px;font-weight:800;font-size:20px}
.dialog .row.decal{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.btn.mode.bo1,.btn.mode.bo3,.btn.mode.bo5{background:linear-gradient(180deg, rgba(148,163,184,.15), rgba(148,163,184,.08));}
.layout{display:grid;grid-template-columns:1fr minmax(0,620px) 1fr;grid-template-areas:'left center right';gap:16px;margin-top:12px}
.leftcol{grid-area:left}
.center{grid-area:center}
.rightcol{grid-area:right}
.side{border-radius:16px;padding:12px;border:1px solid #1f2937;display:flex;flex-direction:column}
.side-blue{background:linear-gradient(180deg, rgba(37,99,235,.7), rgba(14,165,233,.6))}
.side-red{background:linear-gradient(180deg, rgba(244,63,94,.7), rgba(249,115,22,.6))}
.head{display:flex;justify-content:space-between;align-items:center}
.name{font-weight:700;font-size:18px;text-shadow:0 1px 2px rgba(0,0,0,.4)}
.tag{font-size:11px;opacity:.85}
.label{font-size:11px;opacity:.8;margin-top:8px}
.banrow{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-top:4px}
.ban{aspect-ratio:1/1;border-radius:8px;overflow:hidden;background:rgba(15,23,42,.6);border:1px solid #1f2937}
.picks{margin-top:12px}
.pickcol{display:grid;grid-template-rows:repeat(5,1fr);gap:10px;margin-top:4px}
.role-tag{position:absolute;right:8px;bottom:6px;font-size:11px;color:#ffffff;opacity:.95;font-weight:700;letter-spacing:.04em;text-shadow:0 1px 2px rgba(0,0,0,.6)}
/* Symmetry: move role tags to left on RED side */
.side-red .role-tag{left:8px;right:auto}
.pick{height:88px;border-radius:14px;overflow:hidden;background:rgba(15,23,42,.6);border:1px solid #1f2937;position:relative}
.pick.clickable{cursor:pointer}
.pick.clickable:hover{outline:2px solid #94a3b8}
.pick.selected{outline:3px solid #f59e0b}
/* Replace dashed preview with white pulsing glow */
@keyframes pulseGlow{0%{box-shadow:0 0 0 rgba(255,255,255,0);border-color:rgba(255,255,255,.5)}50%{box-shadow:0 0 16px rgba(255,255,255,.9),0 0 28px rgba(255,255,255,.35);border-color:#ffffff}100%{box-shadow:0 0 0 rgba(255,255,255,0);border-color:rgba(255,255,255,.5)}}
.pick.preview{border-color:#ffffff;animation:pulseGlow 1.2s ease-in-out infinite}
.bar{background:rgba(30,41,59,.5);border:1px solid #334155;border-radius:16px;padding:12px}
.row{display:flex;gap:8px;margin:8px 0;align-items:center}
.row.center{justify-content:center}
.state{font-weight:600}
.timer{border-radius:10px;padding:3px 10px;font-family:ui-monospace, SFMono-Regular, Menlo, monospace}
.timer.big{font-size:40px;line-height:1;font-weight:800;padding:10px 20px}
.timer.blue{background:#1d4ed8}
.timer.red{background:#be123c}
/* Urgent countdown (<=10s): red digits with strong outline and pulse */
.timer.urgent,.timer.big.urgent{background:#0b1220!important;border:2px solid #ef4444;color:#ef4444;-webkit-text-stroke:2px #ffffff;text-shadow:0 0 10px rgba(239,68,68,.9),0 0 2px #000;animation:urgentPulse .7s ease-in-out infinite}
@keyframes urgentPulse{0%{transform:scale(1);box-shadow:0 0 0 rgba(239,68,68,0)}50%{transform:scale(1.05);box-shadow:0 0 24px rgba(239,68,68,.5)}100%{transform:scale(1);box-shadow:0 0 0 rgba(239,68,68,0)}}
.steps{display:grid;grid-template-columns:repeat(20,1fr);gap:4px;margin-top:8px}
.dot{height:6px;border-radius:4px;background:#475569}
.dot.blue{background:#3b82f6}
.dot.red{background:#ef4444}
/* OGN-style top bar */
.ogntop{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:12px;margin-bottom:6px}
.team{display:flex;align-items:center;gap:8px;opacity:.7}
.team .tname{font-weight:800;text-transform:none;font-size:clamp(18px,2.6vw,32px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}
.team .lamp{width:12px;height:12px;border-radius:9999px;background:#475569;box-shadow:0 0 0 rgba(0,0,0,0)}
.team.blue.active .lamp{background:#3b82f6;box-shadow:0 0 12px #3b82f6}
.team.red.active .lamp{background:#ef4444;box-shadow:0 0 12px #ef4444}
.team.active{opacity:1}
.team.blue{justify-content:flex-end}
.team.red{justify-content:flex-start}
.team.blue .tname{text-align:right}
.team.red .tname{text-align:left}
.mid{display:flex;flex-direction:column;align-items:center;gap:4px}
.mid .set{font-weight:800;letter-spacing:.08em}
.phase{font-size:12px;color:#cbd5e1}

.toolbar{display:flex;gap:8px;margin-top:10px}
.search{flex:1;background:#0b1220;border:1px solid #334155;border-radius:10px;padding:8px 10px;color:#e2e8f0}
.gridWrap{max-height:320px;overflow:auto;border:1px solid #334155;border-radius:12px;padding:8px;background:#0b1220;margin-top:10px}
.grid{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
.champ{aspect-ratio:1/1;border-radius:12px;overflow:hidden;border:1px solid #334155;background:#0b1220}
.champ img{width:100%;height:100%;object-fit:cover}
.champ.disabled{opacity:.4;pointer-events:none}
.champ.selected{outline:2px solid #f59e0b}
.btn.confirm{width:100%;margin-top:8px}
.trade{margin-top:12px;border:1px solid #64748b;background:rgba(100,116,139,.15);border-radius:12px;padding:10px}
.tr-head{font-weight:700;display:flex;align-items:center;gap:8px}
.badge{background:#0b1220;border:1px solid #334155;border-radius:8px;padding:2px 8px;font-family:ui-monospace}
.tr-sub{font-size:12px;color:#cbd5e1;margin-top:4px}
.tr-actions{display:flex;gap:8px;margin-top:8px;align-items:center;flex-wrap:wrap}
.swap{display:flex;gap:8px;align-items:center}
.finalize{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.carry{margin-top:12px;border:1px solid rgba(148,163,184,.4);background:rgba(148,163,184,.12);border-radius:12px;padding:10px}
.title{font-weight:700;margin-bottom:6px}
.sets{display:flex;flex-direction:column;gap:10px;margin-top:6px}
.setrow{border-top:1px solid #334155;padding-top:8px}
.settitle{font-size:12px;opacity:.9;margin-bottom:6px}
.setteams{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.setlabel{font-size:11px;opacity:.8;margin-bottom:4px}
.banfaces{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
.banfaces img{width:36px;height:36px;border-radius:6px;border:1px solid #334155}
.overlay{position:fixed;inset:0;background:rgba(2,6,23,.8);backdrop-filter:blur(4px);display:grid;place-items:center;z-index:50}
.dialog{width:min(600px,92vw);background:#0b1220;border:1px solid #334155;border-radius:16px;padding:16px;box-shadow:0 8px 40px rgba(0,0,0,.5)}
.dialog h2{margin:0 0 12px 0}
.dialog .row{display:flex;gap:8px;margin:8px 0;align-items:center}
.dialog .row.small{font-size:12px;color:#cbd5e1}
.dialog .in{flex:1;background:#0b1220;border:1px solid #334155;border-radius:10px;padding:10px;color:#e2e8f0}
.btn.active{outline:2px solid #64748b}
.resetmenu{position:absolute; top:36px; right:0; background:#0b1220; border:1px solid #334155; border-radius:12px; padding:8px; display:flex; flex-direction:column; gap:6px; box-shadow:0 8px 24px rgba(0,0,0,.4); z-index:100}
.btn.danger{background:#450a0a; border-color:#7f1d1d}

/* === New top timer bar (blue left, red right) === */
.topbar{display:grid;grid-template-columns:140px 1fr 140px;align-items:center;gap:12px;margin-bottom:8px}
.sideblock{height:64px;border:2px solid #334155;border-radius:10px;display:flex;align-items:center;justify-content:center;background:#0b1220}
.sideblock.left{background:#1d4ed8}
.sideblock.right{background:#ef4444}
.sideblock.off{opacity:.35;filter:grayscale(40%)}
.sideblock.on{box-shadow:0 0 16px rgba(255,255,255,.35), inset 0 0 0 2px rgba(255,255,255,.25)}
.sideblock .count{font-size:28px;line-height:1;font-weight:900;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.7)}
.gamecenter{height:64px;border:2px solid #334155;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:900;letter-spacing:.06em}

/* === Bans at bottom with mirrored order and split gap === */
.bans-bottom{margin-top:12px}
.banrow{display:flex;gap:8px;margin-top:6px}
.ban{width:48px;height:48px;border-radius:8px;overflow:hidden;background:rgba(15,23,42,.6);border:1px solid #1f2937;position:relative}
.ban.split-start{margin-left:16px}
.banimg{position:relative;width:100%;height:100%}
.banimg img{width:100%;height:100%;object-fit:cover;opacity:.95}
/* Prohibited overlay mark */
.ban-mark{position:absolute;inset:6px;border:3px solid rgba(226,232,240,.95);border-radius:9999px;pointer-events:none}
.ban-mark::after{content:"";position:absolute;left:50%;top:50%;width:3px;height:130%;background:rgba(226,232,240,.95);transform:translate(-50%,-50%) rotate(-45deg);border-radius:2px}
/* Unavailable list under each team */
.unavail{margin-top:10px}
.unavail .label{font-size:11px;opacity:.8;margin-bottom:4px;text-align:center}
.unfaces{display:grid;grid-template-columns:repeat(5,42px);gap:8px;justify-content:center}
.unfaces img{width:42px;height:42px;border-radius:8px;border:1px solid #334155;object-fit:cover}
`;

    // ReactDOM 렌더
    ReactDOM.render(<DraftApp />, document.getElementById('root'));
  </script>
</body>
</html>
